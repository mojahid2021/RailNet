generator client {

  provider = "prisma-client-js"

}

datasource db {

  provider = "postgresql"

  url      = env("DATABASE_URL")

}

model User {

  id        Int      @id @default(autoincrement())

  email     String   @unique

  firstName String?

  lastName  String?

  password  String

  role      String   @default("user")

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

}

model Station {

  id        Int      @id @default(autoincrement())

  name      String   @unique

  city      String

  latitude  Float

  longitude Float

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

  // Relations for route stations
  previousStations RouteStation[] @relation("PreviousStation")
  currentStations  RouteStation[] @relation("CurrentStation")
  nextStations     RouteStation[] @relation("NextStation")

  startRoutes TrainRoute[] @relation("StartStation")

  endRoutes   TrainRoute[] @relation("EndStation")

  scheduleStations ScheduleStation[]

}

model TrainRoute {

  id           Int           @id @default(autoincrement())

  name         String        @unique

  startStationId Int

  endStationId   Int

  startStation Station       @relation("StartStation", fields: [startStationId], references: [id])

  endStation   Station       @relation("EndStation", fields: [endStationId], references: [id])

  routeStations RouteStation[]

  trains       Train[]

  schedules    TrainSchedule[]

  createdAt    DateTime      @default(now())

  updatedAt    DateTime      @updatedAt

}

model RouteStation {

  id                Int        @id @default(autoincrement())

  trainRouteId      Int

  trainRoute        TrainRoute @relation(fields: [trainRouteId], references: [id], onDelete: Cascade)

  previousStationId Int?

  currentStationId  Int

  nextStationId     Int?

  distance          Float?     // Distance to next station

  distanceFromStart Float      // Distance from start of route

  previousStation   Station?   @relation("PreviousStation", fields: [previousStationId], references: [id])

  currentStation    Station    @relation("CurrentStation", fields: [currentStationId], references: [id])

  nextStation       Station?   @relation("NextStation", fields: [nextStationId], references: [id])

  createdAt         DateTime   @default(now())

  updatedAt         DateTime   @updatedAt

}

model Compartment {

  id        Int      @id @default(autoincrement())

  name      String

  class     String   // e.g., "First", "Second", "Third"

  type      String   // e.g., "AC", "Non-AC", "Sleeper"

  price     Float    // Price per ticket

  seats     Int      // Number of seats available

  trainCompartments TrainCompartment[]

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

}

model Train {

  id           Int          @id @default(autoincrement())

  name         String       // Train name

  number       String       @unique // Train number

  trainRouteId Int

  trainRoute   TrainRoute   @relation(fields: [trainRouteId], references: [id])

  compartments TrainCompartment[]

  schedules    TrainSchedule[]

  createdAt    DateTime     @default(now())

  updatedAt    DateTime     @updatedAt

}

model TrainCompartment {

  id            Int         @id @default(autoincrement())

  trainId       Int

  compartmentId Int

  train         Train       @relation(fields: [trainId], references: [id], onDelete: Cascade)

  compartment   Compartment @relation(fields: [compartmentId], references: [id])

  createdAt     DateTime    @default(now())

  updatedAt     DateTime    @updatedAt

}

model TrainSchedule {

  id            Int       @id @default(autoincrement())

  trainId       Int

  trainRouteId  Int

  train         Train     @relation(fields: [trainId], references: [id], onDelete: Cascade)

  trainRoute    TrainRoute @relation(fields: [trainRouteId], references: [id])

  date          DateTime  // Schedule date

  time          String    // Departure time (HH:MM format)

  stationTimes  ScheduleStation[]

  createdAt     DateTime  @default(now())

  updatedAt     DateTime  @updatedAt

  @@unique([trainId, date]) // Prevent duplicate schedules for same train on same date

}

model ScheduleStation {

  id                Int           @id @default(autoincrement())

  trainScheduleId   Int

  trainSchedule     TrainSchedule @relation(fields: [trainScheduleId], references: [id], onDelete: Cascade)

  stationId         Int

  station           Station       @relation(fields: [stationId], references: [id])

  arrivalTime       String?       // Arrival time at this station (HH:MM format)

  departureTime     String?       // Departure time from this station (HH:MM format)

  sequence          Int           // Order of station in the schedule

  createdAt         DateTime      @default(now())

  updatedAt         DateTime      @updatedAt

}