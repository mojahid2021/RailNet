@startuml Authentication Flow
!theme plain
title User Authentication Activity Diagram

|User|
start
:Enter credentials\n(email, password);

|#LightBlue|Backend API|
:Receive authentication request;

if (Request type?) then (Register)
  :Extract user details from request;
  
  partition "Registration Process" {
    :Check if email exists;
    
    if (Email already exists?) then (yes)
      :Return 400 error\n"User already exists";
      stop
    else (no)
      :Hash password\nusing bcrypt;
      
      :Create new user\nin database;
      
      :Generate JWT token\nwith user id and role;
      
      :Return user data\nand token;
      stop
    endif
  }
  
else (Login)
  :Extract email and password;
  
  partition "Login Process" {
    :Query user by email;
    
    if (User exists?) then (no)
      :Return 401 error\n"Invalid credentials";
      stop
    else (yes)
      :Compare password hash\nusing bcrypt.compare();
      
      if (Password valid?) then (no)
        :Return 401 error\n"Invalid credentials";
        stop
      else (yes)
        :Generate JWT token\nwith user id and role;
        
        :Return user data\nand token;
        stop
      endif
    endif
  }
endif

note right
  JWT Token contains:
  - User ID
  - User Role (user/admin)
  - Expiration time
end note

@enduml
